class Ball
  include CP::Object

  attr_reader :body, :shape

  def initialize(window)
  @window = window
    @image = Gosu::Image.new(window, "media/ball.png", false)
    @radius = 15.0
    @mass = 20.0
    # The Moment of inertia is like the mass of an object, but applied to its rotation. 
    # An object with a higher moment of inertia is harder to spin.
    @moment = Float::INFINITY
    @body = CP::Body.new(@mass,@moment)
    @shape = CP::Shape::Circle.new(@body, @radius, CP::Vec2.new(0.0, 0.0))
    # Initialisation of our CP::Object
    init_chipmunk_object(@body,@shape)
    # Start the ball : Set to the center, randomize angle and apply impulsion.
    start
  end
  
  def start
    @body.p = CP::Vec2.new(CENTER_X, CENTER_Y) # position
    @shape.body.v = CP::Vec2.new(0.0, 0.0) # velocity
    @body.a = random_radian
    @body.apply_impulse((@body.a.radians_to_vec2 * 10000.0/SUBSTEPS), CP::Vec2.new(0.0, 0.0))
  end
  
  def update
    @body.v.y = -@body.v.y if ( (@body.p.y - @radius) < 0 || (@body.p.y + @radius) > SCREEN_HEIGHT )
  end
  
  def draw
    @image.draw_rot(@body.p.x, @body.p.y, 100, @body.a.radians_to_gosu)
  end
  
  private
  
  def random_radian
    # without UP (3*PI/2) and DOWN (1*PI/2) for more playability
    rnd = rand(50)
    rnd = rand(50) while ( rnd == 30 or rnd == 10 )
    rnd * Math::PI/20.0
  end
  
end
